<?xml version="1.0" encoding="us-ascii"?>
<!--##########################################
    #                                        #
    #     Example steering file for marlin   #
    #     Run TrueJet, output to DST         #
    #                                        #
    ##########################################-->

<marlin xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://ilcsoft.desy.de/marlin/marlin.xsd">

	<constants>
		<constant name="lcgeo_DIR" value="/cvmfs/ilc.desy.de/sw/x86_64_gcc82_centos7/v02-02-03/lcgeo/v00-16-07" />
		<constant name="DetectorModel" value="ILD_l5_o1_v02" />
		<constant name="CompactFile" value="${lcgeo_DIR}/ILD/compact/${DetectorModel}/${DetectorModel}.xml" />
		<constant name="OutputDirectory" value="/nfs/dust/ilc/user/hosseins/DarkPhoton/rec/root" /> <!-- address of output files -->
		<!--constant name="inDir" value="/pnfs/desy.de/ilc/prod/ilc/mc-2020/ild/dst-merged/250-SetA/4f_ZZ_semileptonic/ILD_l5_o1_v02/v02-02" /-->  <!-- address of input files -->
		<constant name="TrueDarkPhotonMass" value="10" />
		<constant name="OutputBaseName" value="${TrueDarkPhotonMass}GeV" />  <!-- name of output files -->
		<constant name="OutputBaseNameIter" value="1" />  <!-- name of output files -->
	</constants>

	<execute>
		<!--processor name="MyIsolatedMuonTaggingProcessor"/-->
		<processor name="MyDarkPhotonMassProcessor"/>
		<!--processor name="DSTOutput"/-->
	</execute>
	<global>
		<parameter name="LCIOInputFiles">/nfs/dust/ilc/user/hosseins/DarkPhoton/rec/eLpR/eLpR_${TrueDarkPhotonMass}_GeV_DST.slcio /nfs/dust/ilc/user/hosseins/DarkPhoton/rec/eRpL/eRpL_${TrueDarkPhotonMass}_GeV_DST.slcio </parameter>
		<parameter name="MaxRecordNumber" value="0" />
		<parameter name="SkipNEvents" value="0" />
		<parameter name="SupressCheck" value="false" />
		<parameter name="GearXMLFile"> /cvmfs/ilc.desy.de/sw/ILDConfig/v02-02-03/StandardConfig/production/Gear/gear_ILD_l5_v02.xml </parameter>
		<parameter name="Verbosity" options="DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT"> DEBUG  </parameter>
		<parameter name="RandomSeed" value="12345678110" />
		<parameter name="OutputSteeringFile" value="${OutputDirectory}/../xml/IsolatedLeptonTagging_Parsed.xml"/>
		<!-- optionally limit the collections that are read from the input file: -->
		<!--parameter name="LCIOReadCollectionNames">MCParticle PandoraPFOs</parameter-->
	</global>

	<processor name="MyIsolatedMuonTaggingProcessor" type="IsolatedLeptonTaggingProcessor">
		<!--IsolatedLeptonTaggingProcessor does whatever it does ...-->
		<!--cosine of the larger cone-->
		<parameter name="CosConeLarge" type="float">0.95 </parameter>
		<!--cosine of the smaller cone-->
		<parameter name="CosConeSmall" type="float">0.975 </parameter>
		<!--Cut on the mva output of isolated electron selection-->
		<parameter name="CutOnTheISOElectronMVA" type="float"> 2 </parameter>
		<!--Cut on the mva output of isolated muon selection-->
		<parameter name="CutOnTheISOMuonMVA" type="float">0.7 </parameter>
		<!--Directory of Weights for the Isolated Electron MVA Classification-->
		<parameter name="DirOfISOElectronWeights" type="string">/cvmfs/ilc.desy.de/sw/x86_64_gcc82_centos7/v02-02-02/MarlinReco/v01-31/Analysis/IsolatedLeptonTagging/example/isolated_electron_weights </parameter>
		<!--Directory of Weights for the Isolated Muon MVA Classification-->
		<parameter name="DirOfISOMuonWeights" type="string">/cvmfs/ilc.desy.de/sw/x86_64_gcc82_centos7/v02-02-02/MarlinReco/v01-31/Analysis/IsolatedLeptonTagging/example/isolated_muon_weights_woYoke </parameter>
		<!--Name of the PandoraPFOs collection-->
		<parameter name="InputPandoraPFOsCollection" type="string" lcioInType="ReconstructedParticle">PandoraPFOs </parameter>
		<!--Name of the Primary Vertex collection-->
		<parameter name="InputPrimaryVertexCollection" type="string" lcioInType="ReconstructedParticle">PrimaryVertex </parameter>
		<!--flag to select one most like isolated lepton-->
		<parameter name="IsSelectingOneIsoLep" type="bool">false </parameter>
		<!--Maximum d0 significance for electron-->
		<parameter name="MaxD0SigForElectron" type="float">50 </parameter>
		<!--Maximum D0 significance for muon-->
		<parameter name="MaxD0SigForMuon" type="float">20 </parameter>
		<!--Maximum ratio of energy in calorimeters over momentum for electron-->
		<parameter name="MaxEOverPForElectron" type="float">1.3 </parameter>
		<!--Maximum ratio of energy in calorimeters over momentum for muon-->
		<parameter name="MaxEOverPForMuon" type="float">0.3 </parameter>
		<!--Maximum Z0 significance for electron-->
		<parameter name="MaxZ0SigForElectron" type="float">50 </parameter>
		<!--Maximum Z0 significance for muon-->
		<parameter name="MaxZ0SigForMuon" type="float">20 </parameter>
		<!--minimum ratio of energy in calorimeters over momentum for electron-->
		<parameter name="MinEOverPForElectron" type="float">0.5 </parameter>
		<!--minimum ratio of energy in ecal over energy in ecal+hcal-->
		<parameter name="MinEecalOverTotEForElectron" type="float">0.9 </parameter>
		<!--Minimum energy in yoke for electron-->
		<parameter name="MinEyokeForMuon" type="float">1.2 </parameter>
		<!--Minimum momentum for electron-->
		<parameter name="MinPForElectron" type="float">5 </parameter>
		<!--Minimum momentum for muon-->
		<parameter name="MinPForMuon" type="float">5 </parameter>
		<!--Name of collection with the selected isolated lepton-->
		<parameter name="OutputIsoLeptonsCollection" type="string" lcioOutType="ReconstructedParticle">ISOMuons </parameter>
		<!--Name of the new PFOs collection without isolated lepton-->
		<parameter name="OutputPFOsWithoutIsoLepCollection" type="string" lcioOutType="ReconstructedParticle">PandoraPFOsWithoutIsoMuons </parameter>
		<!--use yoke for muon ID-->
		<parameter name="UseYokeForMuonID" type="bool">false </parameter>
		<!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
		<parameter name="Verbosity" type="string">MESSAGE </parameter>
	</processor>

	<processor name="MyDarkPhotonMassProcessor" type="DarkPhotonMassProcessor">
		<!--Name of the Isolated Lepton collection-->
		<parameter name="IsoLepCollection" type="string" lcioInType="RECONSTRUCTEDPARTICLE">ISOMuons </parameter>
		<!--Name of the Isolated Lepton collection-->
		<parameter name="TrackMCTruthLinkCollection" type="string" lcioInType="LCRELATION">MarlinTrkTracksMCTruthLink </parameter>
		<!--Name of the MCTruthTrack collection-->
		<parameter name="MCTruthTrackLinkCollection" type="string" lcioInType="LCRELATION">MCTruthMarlinTrkTracksLink </parameter>
		<!--Name of the Track collection-->
		<parameter name="Trackcollection" type="string" lcioInType="TRACK">MarlinTrkTracks </parameter>
		<!--Name of the PandoraPFOs collection-->
		<parameter name="PfoCollection" type="string" lcioInType="RECONSTRUCTEDPARTICLE">PandoraPFOs </parameter>
		<!--Name of the MCParticle collection-->
		<parameter name="MCParticleCollection" type="string" lcioInType="MCPARTICLE">MCParticlesSkimmed </parameter>
		<!--true mass of dark photon-->
		<parameter name="trueDarkPhotonMass" type="float">${TrueDarkPhotonMass} </parameter>
		<!--parameter name="RootFile" type="string" >${OutputDirectory}/${OutputBaseName}_DiMuonInvMass_${OutputBaseNameIter}.root</parameter-->
		<parameter name="RootFile" type="string" >${OutputDirectory}/${OutputBaseName}_DiMuonInvMass.root</parameter>
		<!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
		<parameter name="Verbosity" type="string">MESSAGE </parameter>
	</processor>

	<processor name="DSTOutput" type="LCIOOutputProcessor">
		<!--
			DST output: drop all hits, skim MCParticles and keep final Tracks, Clusters and  ReconstructedParticles
			TO DO:  add LCFI flavour tag stuff
		-->
		<parameter name="LCIOOutputFile" type="string" >${OutputDirectory}/${OutputBaseName}_${OutputBaseNameIter}.slcio</parameter>
		<parameter name="DropCollectionTypes" type="StringVec">	</parameter>
		<parameter name="FullSubsetCollections" type="StringVec" value="MCParticlesSkimmed2"/>
		<parameter name="KeepCollectionNames" type="StringVec"> ISOMuons PandoraPFOsWithoutIsoMuons </parameter>
		<parameter name="LCIOWriteMode" type="string" value="WRITE_NEW"/>
		<!--parameter name="SplitFileSizekB" type="int" value="1992294"/-->
	</processor>

</marlin>
